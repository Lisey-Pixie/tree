<!DOCTYPE html>
<html>
<head>
    <title>Tree Identifier</title>
</head>
{% extends "base.html" %}
{% block title %}Tree Identifier{% endblock %}

{% block content %}
    <!-- Main heading for the identifier page -->
    <h1>Virginia Tree Identifier</h1>

    <!-- If an image and description are available (after a tree is selected), show them -->
    {% if image %}
        <img src="{{ url_for('static', filename=image) }}" alt="Tree Image" class="tree-image">
        <div style="text-align: center; font-size:1.2em; font-weight:bold; margin-bottom:20px;">
            <h3>{{ tree_name }}</h3>
            <p>{{ description }}</p>
        </div>
    {% endif %}

    <br>

    <!-- Show the top 3 possible matches after the user submits the form -->
    {% if matches %}
        <h2>Top 3 Possible Matches:</h2>
        <!-- Form to select one of the matches and get its description -->
        <form method="post">
            <!-- Hidden fields to preserve user input when submitting for description -->
            <input type="hidden" name="leaf_type" value="{{ user_description.leaf_type }}">
            <input type="hidden" name="leaf_number" value="{{ user_description.leaf_number }}">
            <input type="hidden" name="leaf_shape" value="{{ user_description.leaf_shape }}">
            <input type="hidden" name="leaf_size" value="{{ user_description.leaf_size }}">
            <input type="hidden" name="leaf_color" value="{{ user_description.leaf_color }}">
            <input type="hidden" name="leaf_edge" value="{{ user_description.leaf_edge }}">
            <input type="hidden" name="venation" value="{{ user_description.venation }}">
            <input type="hidden" name="texture" value="{{ user_description.texture }}">
            <input type="hidden" name="leaf_autum" value="{{ user_description.leaf_autum }}">
            <ul>
                <!-- List the top 3 matches with radio buttons for selection -->
                {% for name, score in matches[:3] %}
                    <li>
                        <input type="radio" name="tree_choice" value="{{ name }}" id="{{ name }}">
                        <label for="{{ name }}">{{ name }} (score: {{ score }})</label>
                    </li>
                {% endfor %}
            </ul>
            <input type="submit" name="get_description" value="Get Description">
        </form>
    {% endif %}

    <!-- Tree identification form for user input -->
    <h2>Identify a Tree</h2>
    <p>To identify a tree, please provide the following information about its leaves:</p>
    <form method="post">
        <!-- Dropdown for leaf type -->
        <label>Is the leaf simple or compound?</label>
        <select name="leaf_type">
            <option value="">Select...</option>
            <option value="simple" {% if user_description.leaf_type == 'simple' %}selected{% endif %}>Simple</option>
            <option value="compound" {% if user_description.leaf_type == 'compound' %}selected{% endif %}>Compound</option>
        </select><br><br>

        <!-- Input for number of leaflets or needles -->
        <label>How many leaflets, or needles in a cluster? (comma separated for multiple values, e.g., 5, 7, 9):</label>
        <input name="leaf_number" value="{{ user_description.leaf_number }}"><br><br>

        <!-- Dropdown for leaf shape -->
        <label>How is the leaf shaped?</label>
        <select name="leaf_shape">
            <option value="">Select...</option>
            <option value="lobed" {% if user_description.leaf_shape == 'lobed' %}selected{% endif %}>Lobed</option>
            <option value="palmate" {% if user_description.leaf_shape == 'palmate' %}selected{% endif %}>Palmate</option>
            <option value="oval" {% if user_description.leaf_shape == 'oval' %}selected{% endif %}>Oval</option>
            <option value="elliptical" {% if user_description.leaf_shape == 'elliptical' %}selected{% endif %}>Elliptical</option>
            <option value="needles" {% if user_description.leaf_shape == 'needles' %}selected{% endif %}>Needles</option>
            <option value="diamond" {% if user_description.leaf_shape == 'diamond' %}selected{% endif %}>Diamond</option>
            <option value="lanceolate" {% if user_description.leaf_shape == 'lanceolate' %}selected{% endif %}>Lanceolate</option>
            <option value="ovate" {% if user_description.leaf_shape == 'ovate' %}selected{% endif %}>Ovate</option>
            <option value="heart-shaped" {% if user_description.leaf_shape == 'heart-shaped' %}selected{% endif %}>Heart-shaped</option>
            <option value="triangular" {% if user_description.leaf_shape == 'triangular' %}selected{% endif %}>Triangular</option>
        </select><br><br>

        <!-- Dropdown for leaf size -->
        <label>What is the size of the leaf?</label>
        <select name="leaf_size">
            <option value="">Select...</option>
            <option value="small" {% if user_description.leaf_size == 'small' %}selected{% endif %}>Small</option>
            <option value="medium" {% if user_description.leaf_size == 'medium' %}selected{% endif %}>Medium</option>
            <option value="large" {% if user_description.leaf_size == 'large' %}selected{% endif %}>Large</option>
        </select><br><br>

        <!-- Dropdown for leaf color -->
        <label>What is the leaf color?</label>
        <select name="leaf_color">
            <option value="">Select...</option>
            <option value="green" {% if user_description.leaf_color == 'green' %}selected{% endif %}>Green</option>
            <option value="yellow" {% if user_description.leaf_color == 'yellow' %}selected{% endif %}>Yellow</option>
            <option value="brown" {% if user_description.leaf_color == 'brown' %}selected{% endif %}>Brown</option>
            <option value="red" {% if user_description.leaf_color == 'red' %}selected{% endif %}>Red</option>
            <option value="orange" {% if user_description.leaf_color == 'orange' %}selected{% endif %}>Orange</option>
            <option value="purple" {% if user_description.leaf_color == 'purple' %}selected{% endif %}>Purple</option>
            <option value="gold" {% if user_description.leaf_color == 'gold' %}selected{% endif %}>Gold</option>
        </select><br><br>

        <!-- Dropdown for leaf edge -->
        <label>What is the leaf edge like?</label>
        <select name="leaf_edge">
            <option value="">Select...</option>
            <option value="smooth" {% if user_description.leaf_edge == 'smooth' %}selected{% endif %}>Smooth</option>
            <option value="serrated" {% if user_description.leaf_edge == 'serrated' %}selected{% endif %}>Serrated</option>
            <option value="deeply lobed" {% if user_description.leaf_edge == 'deeply lobed' %}selected{% endif %}>Deeply Lobed</option>
            <option value="lobed" {% if user_description.leaf_edge == 'lobed' %}selected{% endif %}>Lobed</option>
            <option value="sharp" {% if user_description.leaf_edge == 'sharp' %}selected{% endif %}>Sharp</option>
        </select><br><br>

        <!-- Dropdown for venation -->
        <label>What is the leaf venation?</label>
        <select name="venation">
            <option value="">Select...</option>
            <option value="pinnate" {% if user_description.venation == 'pinnate' %}selected{% endif %}>Pinnate</option>
            <option value="palmate" {% if user_description.venation == 'palmate' %}selected{% endif %}>Palmate</option>
            <option value="parallel" {% if user_description.venation == 'parallel' %}selected{% endif %}>Parallel</option>
        </select><br><br>

        <!-- Dropdown for texture -->
        <label>How is the texture of the leaf?</label>
        <select name="texture">
            <option value="">Select...</option>
            <option value="smooth" {% if user_description.texture == 'smooth' %}selected{% endif %}>Smooth</option>
            <option value="rough" {% if user_description.texture == 'rough' %}selected{% endif %}>Rough</option>
        </select><br><br>

        <!-- Dropdown for autumn color -->
        <label>What color does the leaf turn in autumn?</label>
        <select name="leaf_autum">
            <option value="">Select...</option>
            <option value="red" {% if user_description.leaf_autum == 'red' %}selected{% endif %}>Red</option>
            <option value="yellow" {% if user_description.leaf_autum == 'yellow' %}selected{% endif %}>Yellow</option>
            <option value="orange" {% if user_description.leaf_autum == 'orange' %}selected{% endif %}>Orange</option>
            <option value="copper" {% if user_description.leaf_autum == 'copper' %}selected{% endif %}>Copper</option>
            <option value="brown" {% if user_description.leaf_autum == 'brown' %}selected{% endif %}>Brown</option>
            <option value="purple" {% if user_description.leaf_autum == 'purple' %}selected{% endif %}>Purple</option>
            <option value="gold" {% if user_description.leaf_autum == 'gold' %}selected{% endif %}>Gold</option>
            <option value="evergreen" {% if user_description.leaf_autum == 'evergreen' %}selected{% endif %}>Evergreen</option>
            <option value="unknown" {% if user_description.leaf_autum == 'unknown' %}selected{% endif %}>Unknown</option>
        </select><br><br>

        <!-- Submit and Reset buttons -->
        <input type="submit" value="Identify">
        <!-- Reset button reloads the page to clear all fields and results -->
        <button type="button" onclick="window.location.href=window.location.pathname" style="margin-left:10px;">Reset</button>
    </form>

    <!-- If a tree description is available, display it -->
    {% if description %}
        <h2>Description:</h2>
        <p>{{ description }}</p>
    {% endif %}

    <!-- Button to return to the home page -->
    <a href="{{ url_for('index') }}">
        <button type="button">Back to Home</button>
    </a>

    <!-- If the user has identified trees, show the list and a clear button -->
    {% if session.identified_trees %}
        <h2>Trees You Have Identified:</h2>
        <ul>
            {% for tname in session.identified_trees %}
                <li>
                    <a href="{{ url_for('tree_data', name=tname) }}">{{ tname }}</a>
                </li>
            {% endfor %}
        </ul>
        <!-- Inline form to clear the identified trees list -->
        <form method="post" action="{{ url_for('clear_identified') }}" class="inline-form">
            <button type="submit">Clear Identified Trees</button>
        </form>
    {% endif %}

    <br>
    <!-- Footer for the page -->
    <footer>
        <p>Powered by Tree Identifier</p>
    </footer>
{% endblock %}

</html>